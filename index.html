<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Assistant IA ‚Äî D√©mo</title>

  <style>
    /* ===== Th√®me mauve & blanc ===== */
    :root{
      --bg: #fbfaff;
      --bg-grad1:#f3edff;
      --bg-grad2:#ffffff;
      --card:#ffffff;
      --text:#0f1222;
      --muted:#6b7280;
      --primary:#7c3aed;       /* üíú mauve principal */
      --primary-600:#6d28d9;
      --primary-100:#eee7ff;
      --ring:#e7dbff;
      --success:#10b981;
      --border:#ececf5;
      --shadow: 0 18px 40px rgba(124,58,237,.18);
      --radius:20px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% 10%, var(--bg-grad1), transparent),
        radial-gradient(1200px 700px at 85% 0%, var(--bg-grad1), transparent),
        var(--bg);
    }

    /* ===== Layout ===== */
    .wrap{min-height:100%; padding:32px}
    .container{max-width:1100px; margin:0 auto}

    /* ===== Hero ===== */
    .hero{
      background: linear-gradient(180deg,#fff, #f9f7ff);
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:32px 26px;
      display:flex; align-items:center; justify-content:space-between; gap:24px;
      box-shadow: var(--shadow);
    }
    .hero h1{margin:0 0 8px 0; font-size:28px; letter-spacing:.2px}
    .hero p{margin:0; color:var(--muted)}
    .cta{
      background: var(--primary);
      color:#fff; border:none; cursor:pointer; font-weight:700;
      padding:14px 22px; border-radius:14px; font-size:17px;
      box-shadow: 0 14px 28px rgba(124,58,237,.28);
      transition: transform .06s ease, box-shadow .2s ease, background .2s ease;
      white-space:nowrap;
    }
    .cta:hover{ transform: translateY(-1px); background:var(--primary-600) }

    /* ===== Grille ===== */
    .grid{display:grid; grid-template-columns: 360px 1fr; gap:24px; margin-top:24px}
    @media (max-width: 960px){
      .grid{grid-template-columns: 1fr}
    }

    /* ===== Cards ===== */
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    /* ===== Panneau gauche ===== */
    .side{
      padding:20px; display:flex; flex-direction:column; gap:16px;
      position:sticky; top:24px; height:max-content;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      background: var(--primary-100);
      color: var(--primary);
      border: 1px solid var(--ring);
      padding:6px 10px; border-radius: 999px;
      font-weight:700; font-size:12px; letter-spacing:.25px;
    }
    .profile{
      padding:16px; border:1px dashed var(--ring); border-radius:14px;
      background:linear-gradient(180deg,#fff, #faf7ff);
    }
    .profile h3{margin:0 0 6px 0; font-size:16px}
    .profile p{margin:2px 0; color:var(--muted); font-size:14px}

    .select-row{
      display:flex; gap:10px; align-items:center;
      padding:10px; border-radius:12px; border:1px solid var(--border); background:#fff;
    }
    label{font-size:13px; color:var(--muted)}
    select{
      appearance:none; width:100%;
      padding:10px 12px; border-radius:10px; border:1px solid var(--border);
      background:#fff; font-weight:600; color:var(--text);
      outline: none;
    }
    select:focus{box-shadow: 0 0 0 4px var(--ring); border-color:var(--primary)}
    .hint{font-size:12px; color:var(--muted); margin-top:4px}

    /* ===== Chat ===== */
    .chat{display:flex; flex-direction:column; height:min(78vh, 780px); padding:16px}
    .chat-header{
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 12px 14px 12px; border-bottom:1px solid var(--border);
    }
    .chat-header h2{margin:0; font-size:18px}
    .status{display:flex; align-items:center; gap:8px; color:var(--muted); font-size:13px}
    .dot{width:8px; height:8px; background:var(--success); border-radius:50%}

    .messages{flex:1; overflow:auto; padding:16px 6px; scroll-behavior:smooth}
    .row{display:flex; align-items:flex-end; gap:8px}
    .row.right{justify-content:flex-end}
    .bubble{
      max-width: 70%;
      padding:12px 14px; margin:10px 0;
      border-radius:16px; line-height:1.45; font-size:15px;
      box-shadow: 0 4px 16px rgba(17,24,39, .06);
      border:1px solid var(--border); white-space:pre-wrap; word-break:break-word;
    }
    .bot{ background:#fff }
    .user{
      margin-left:auto;
      background: linear-gradient(180deg, var(--primary), var(--primary-600));
      color:white; border:none;
    }

    .composer{display:flex; gap:10px; padding:12px; border-top:1px solid var(--border)}
    .composer input{
      flex:1; padding:14px 16px; border-radius:12px; border:1px solid var(--border);
      outline:none; font-size:15px; background:#fff;
    }
    .composer input:focus{box-shadow:0 0 0 4px var(--ring); border-color:var(--primary)}
    .btn{
      padding:12px 16px; border-radius:12px; border:1px solid var(--primary);
      background: var(--primary); color:white; font-weight:700;
      cursor:pointer; transition: transform .06s ease, box-shadow .2s ease;
      box-shadow: 0 10px 16px rgba(124,58,237,.22);
    }
    .btn:hover{transform: translateY(-1px)}
    .btn:disabled{opacity:.6; cursor:not-allowed; box-shadow:none}

    /* 3 points "typing" */
    .typing{display:inline-flex; gap:4px; padding:10px 12px}
    .dot-anim{width:8px; height:8px; border-radius:50%; background:var(--primary); animation: blink 1.4s infinite both}
    .dot-anim:nth-child(2){ animation-delay:.2s }
    .dot-anim:nth-child(3){ animation-delay:.4s }
    @keyframes blink{ 0%{opacity:.2; transform:translateY(0)} 20%{opacity:1; transform:translateY(-3px)} 100%{opacity:.2; transform:translateY(0)} }

    /* Affichage diff√©r√© du chat */
    #chatWrapper{display:none; opacity:0; transition: opacity .5s ease}
    #chatWrapper.shown{display:block; opacity:1}

    /* Mobile */
    @media (max-width: 960px){
      .side{position: static; top: auto; margin-bottom: 12px}
      .chat{height: calc(100dvh - 160px)}
      .messages{padding: 12px 6px}
      .hero{flex-direction:column; align-items:flex-start}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="container">

      <!-- ========= HERO avec bouton pour r√©v√©ler le chatbot ========= -->
      <section class="hero">
        <div>
          <h1>Assistant IA ‚Äî D√©mo</h1>
          <p>Testez l‚Äôassistant en un clic, directement sur cette page. Aucune redirection.</p>
        </div>
        <button id="openChat" class="cta">üí¨ Tester le chatbot</button>
      </section>

      <!-- ========= Le chatbot (cach√© par d√©faut) ========= -->
      <div id="chatWrapper">
        <div class="grid">
          <!-- Colonne gauche -->
          <aside class="card side">
            <span class="badge">Assistant IA ‚Ä¢ D√©mo</span>

            <div class="profile">
              <h3 id="tenantName">Cabinet Martin Coaching</h3>
              <p>‚Ä¢ Tarif s√©ance : <strong id="tenantPrice">80‚Ç¨ / h</strong></p>
              <p>‚Ä¢ Disponibilit√©s : <strong id="tenantHours">Lun‚ÄìVen 9h‚Äì18h</strong></p>
              <p>‚Ä¢ Canaux : <strong id="tenantChannels">Visio & pr√©sentiel</strong></p>
            </div>

            <div class="select-row">
              <label for="mode">Mode</label>
              <select id="mode">
                <option value="pro">Pro (ton s√©rieux)</option>
                <option value="chaleureux">Chaleureux (humain)</option>
                <option value="coach">Coach Business Sophie</option>
                <option value="cabinet_osteo">Cabinet Ost√©o Duval</option>
              </select>
            </div>

            <p class="hint">Astuce : change de mode pour montrer diff√©rentes ‚Äúpersonas‚Äù sans toucher au code.</p>
          </aside>

          <!-- Colonne droite (chat) -->
          <section class="card chat" aria-live="polite">
            <div class="chat-header">
              <h2>Assistant IA</h2>
              <div class="status"><span class="dot"></span>En ligne</div>
            </div>

            <div id="messages" class="messages"></div>

            <form id="chatForm" class="composer" autocomplete="off">
              <input id="userInput" placeholder="Pose ta question‚Ä¶" />
              <button id="sendBtn" class="btn" type="submit">Envoyer</button>
            </form>
          </section>
        </div>
      </div>
      <!-- ============================================================ -->

    </div>
  </div>

  <script>
    // ======== R√©v√©ler le chat au clic (et initialiser une seule fois) ========
    const chatWrapper = document.getElementById("chatWrapper");
    const openChatBtn = document.getElementById("openChat");
    let chatInitialized = false;

    openChatBtn.addEventListener("click", () => {
      chatWrapper.classList.add("shown");
      openChatBtn.style.display = "none";
      if (!chatInitialized) {
        initChat();              // cr√©e le message d'accueil etc.
        chatInitialized = true;  // emp√™che toute double init
      }
      // focus dans l'input apr√®s affichage
      setTimeout(() => document.getElementById("userInput").focus(), 50);
    });

    // ======== Logique du chat (identique, mais appel√©e √† l‚Äôouverture) ========
    function initChat(){
      const messagesEl = document.getElementById("messages");
      const form = document.getElementById("chatForm");
      const input = document.getElementById("userInput");
      const modeSelect = document.getElementById("mode");
      const sendBtn = document.getElementById("sendBtn");

      function appendBot(text){
        const row = document.createElement("div");
        row.className = "row";
        const b = document.createElement("div");
        b.className = "bubble bot";
        b.textContent = text;
        row.appendChild(b);
        messagesEl.appendChild(row);
        messagesEl.scrollTop = messagesEl.scrollHeight;
      }
      function appendUser(text){
        const row = document.createElement("div");
        row.className = "row right";
        const b = document.createElement("div");
        b.className = "bubble user";
        b.textContent = text;
        row.appendChild(b);
        messagesEl.appendChild(row);
        messagesEl.scrollTop = messagesEl.scrollHeight;
      }

      // Animation "bot √©crit"
      let typingBubble=null;
      function showTyping(){
        typingBubble=document.createElement("div");
        typingBubble.className="row";
        const bubble=document.createElement("div");
        bubble.className="bubble bot typing";
        bubble.innerHTML=`<span class="dot-anim"></span><span class="dot-anim"></span><span class="dot-anim"></span>`;
        typingBubble.appendChild(bubble);
        messagesEl.appendChild(typingBubble);
        messagesEl.scrollTop=messagesEl.scrollHeight;
      }
      function hideTyping(){ if(typingBubble){ typingBubble.remove(); typingBubble=null; } }

      // Cartouche de gauche dynamique
      const tenants = {
        pro:       { name:"Assistant Pro", price:"‚Äî", hours:"‚Äî", channels:"‚Äî" },
        chaleureux:{ name:"Assistant Chaleureux", price:"‚Äî", hours:"‚Äî", channels:"‚Äî" },
        coach:     { name:"Sophie Martin ‚Ä¢ Coaching", price:"80‚Ç¨ / h", hours:"Lun‚ÄìVen 9h‚Äì18h", channels:"Visio & pr√©sentiel (Lyon)" },
        cabinet_osteo: { name:"Cabinet Ost√©o Duval", price:"65‚Ç¨ / s√©ance", hours:"Lun‚ÄìSam matin", channels:"Pr√©sentiel ‚Ä¢ Bruxelles" }
      };
      const nameEl = document.getElementById("tenantName");
      const priceEl = document.getElementById("tenantPrice");
      const hoursEl = document.getElementById("tenantHours");
      const channelsEl = document.getElementById("tenantChannels");
      function refreshTenantCard(){
        const t = tenants[modeSelect.value] || tenants.pro;
        nameEl.textContent = t.name;
        priceEl.textContent = t.price;
        hoursEl.textContent = t.hours;
        channelsEl.textContent = t.channels;
      }
      modeSelect.addEventListener("change", refreshTenantCard);
      refreshTenantCard();

      // Message d‚Äôaccueil (au moment o√π le chat appara√Æt)
      appendBot("Bonjour üëã Je suis l‚Äôassistant. Pose-moi ta question ou choisis un mode pour tester une persona.");

      // Envoi
      form.addEventListener("submit", async (e)=>{
        e.preventDefault();
        const text = input.value.trim();
        if(!text) return;

        appendUser(text);
        input.value = "";
        input.focus();
        sendBtn.disabled = true;

        showTyping();
        try{
          const res = await fetch("/api/chat", {
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body: JSON.stringify({ userMessage: text, mode: modeSelect.value })
          });
          hideTyping();
          if(!res.ok){
            appendBot("‚ö†Ô∏è Erreur serveur. R√©essaie dans un instant.");
          }else{
            const data = await res.json();
            appendBot(data.answer || "(pas de r√©ponse)");
          }
        }catch(err){
          hideTyping();
          appendBot("‚ö†Ô∏è R√©seau indisponible.");
        }finally{
          sendBtn.disabled = false;
        }
      });
    }
  </script>
</body>
</html>
